<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© â€“ Ù…Ø¯Ø±Ø³Ø© Ø¯Ø§Ø± Ø§Ù„Ø³Ù„Ø§Ù… / Ù„ÙˆØ§Ø¡ Ù…Ø§Ø±ÙƒØ§</title>

<style>
  body{font-family:Arial,Tahoma,sans-serif;background:#f4f6f8;margin:0}
  header{background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.08);position:sticky;top:0;z-index:10}
  .wrap{max-width:1100px;margin:auto;padding:18px}
  h1{margin:0;font-size:26px;color:#2c3e50}
  .sub{color:#566;font-size:14px;margin-top:6px}

  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;align-items:center}
  input,select,button,textarea{padding:10px;border-radius:10px;border:1px solid #ddd;font-size:14px;background:#fff}
  input{flex:1;min-width:200px}
  button{cursor:pointer}
  .primary{background:#1abc9c;color:#fff;border:none}
  .danger{background:#fff;border:1px solid #f2b3b3;color:#b42318}
  .ghost{background:#fff}
  .primary:hover{filter:brightness(.95)}
  .danger:hover{background:#fff5f5}

  main{max-width:1100px;margin:auto;padding:18px}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}

  .card{background:#fff;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);overflow:hidden;display:flex;flex-direction:column;border:1px solid #f0f3f6}
  .thumb{height:160px;background:#eef2f5;display:flex;align-items:center;justify-content:center}
  .thumb img{height:100%;width:100%;object-fit:cover;display:block}
  .thumb .ph{color:#778;font-size:13px}
  .content{padding:14px;display:flex;flex-direction:column;gap:8px}
  .title{font-size:18px;margin:0;color:#223}
  .meta{font-size:13px;color:#666;line-height:1.6}
  .actions{margin-top:auto;display:flex;gap:8px;flex-wrap:wrap;padding-top:8px}

  /* Stats */
  .statsBox{background:#fff;border:1px solid #eef1f4;border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.04);padding:12px;margin-bottom:12px}
  .statsTop{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .statsTop .total{color:#445;font-size:14px}
  .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:#f7f9fb;border:1px solid #eef1f4;border-radius:999px;padding:6px 10px;color:#445;font-size:12px}

  /* Modal */
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px;z-index:100}
  .modal{background:#fff;border-radius:16px;max-width:560px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.25);overflow:hidden}
  .modalHead{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #eef1f4}
  .modalTitle{margin:0;font-size:18px;color:#223}
  .close{background:#eef2f5;border:none;border-radius:10px;padding:8px 10px;cursor:pointer}
  .modalBody{padding:16px}
  .modalBody textarea{width:100%;min-height:90px;resize:vertical}
  .modalBody input,.modalBody select,.modalBody textarea{width:100%;margin-bottom:10px}
  .rowBtns{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-start;margin-top:6px}

  /* View Modal */
  .viewModal{max-width:900px}
  .viewBody{display:grid;grid-template-columns:300px 1fr;gap:14px;padding:16px}
  .viewImg{width:100%;height:360px;object-fit:cover;border-radius:14px;background:#eef2f5}
  .block{background:#f7f9fb;border:1px solid #eef1f4;border-radius:14px;padding:12px;margin-top:10px}
  .block h3{margin:0 0 8px;font-size:15px;color:#223}
  .block p{margin:0;color:#455;line-height:1.9}
  .hint{color:#667;font-size:12px;margin-top:-4px;margin-bottom:10px}

  @media (max-width:900px){
    .viewBody{grid-template-columns:1fr}
    .viewImg{height:240px}
  }
</style>
</head>

<body>

<header>
  <div class="wrap">
    <h1>ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h1>
    <p class="sub">Ù…Ø¯Ø±Ø³Ø© Ø¯Ø§Ø± Ø§Ù„Ø³Ù„Ø§Ù… / Ù„ÙˆØ§Ø¡ Ù…Ø§Ø±ÙƒØ§</p>

    <div class="controls">
      <input id="search" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ Ø£Ùˆ Ù…Ø¤Ù„Ù...">

      <select id="deweyFilter">
        <option value="all">ÙƒÙ„ ØªØµÙ†ÙŠÙØ§Øª Ø¯ÙŠÙˆÙŠ</option>
        <option value="000">000 Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ø¹Ø§Ù…Ø©</option>
        <option value="100">100 Ø§Ù„ÙÙ„Ø³ÙØ©</option>
        <option value="200">200 Ø§Ù„Ø¯ÙŠÙ†</option>
        <option value="300">300 Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
        <option value="400">400 Ø§Ù„Ù„ØºØ§Øª</option>
        <option value="500">500 Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
        <option value="600">600 Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
        <option value="700">700 Ø§Ù„ÙÙ†ÙˆÙ†</option>
        <option value="800">800 Ø§Ù„Ø£Ø¯Ø¨</option>
        <option value="900">900 Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
      </select>

      <button class="primary" id="addBtn">â• Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨</button>
      <button class="ghost" id="resetBtn">Ù…Ø³Ø­</button>
    </div>
  </div>
</header>

<main>
  <div class="statsBox" id="statsBox">
    <div class="statsTop">
      <div class="total" id="totalText">â€”</div>
      <div class="total" style="font-size:12px;color:#667">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø­Ø³Ø¨ ØªØµÙ†ÙŠÙ Ø¯ÙŠÙˆÙŠ</div>
    </div>
    <div class="chips" id="chips"></div>
  </div>

  <div id="grid" class="grid"></div>
</main>

<!-- Modal: Add/Edit -->
<div id="formBackdrop" class="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal">
    <div class="modalHead">
      <h2 class="modalTitle" id="formTitle">Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨</h2>
      <button class="close" id="formClose">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
    </div>
    <div class="modalBody">
      <input id="fTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ *">
      <input id="fAuthor" placeholder="Ø§Ù„Ù…Ø¤Ù„Ù *">

      <select id="fDewey">
        <option value="000">000 Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ø¹Ø§Ù…Ø©</option>
        <option value="100">100 Ø§Ù„ÙÙ„Ø³ÙØ©</option>
        <option value="200">200 Ø§Ù„Ø¯ÙŠÙ†</option>
        <option value="300">300 Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
        <option value="400">400 Ø§Ù„Ù„ØºØ§Øª</option>
        <option value="500">500 Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
        <option value="600">600 Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
        <option value="700">700 Ø§Ù„ÙÙ†ÙˆÙ†</option>
        <option value="800">800 Ø§Ù„Ø£Ø¯Ø¨</option>
        <option value="900">900 Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
      </select>

      <textarea id="fDesc" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± / Ù…Ù„Ø®Øµ"></textarea>

      <label style="font-size:13px;color:#445;display:block;margin-bottom:6px;">ğŸ“· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
      <input id="fCoverFile" type="file" accept="image/*">
      <div class="hint">Ø§Ù„ØµÙˆØ±Ø© ØªÙØ­ÙØ¸ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².</div>

      <div class="rowBtns">
        <button class="primary" id="saveBtn">Ø­ÙØ¸ âœ…</button>
        <button class="ghost" id="cancelBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: View -->
<div id="viewBackdrop" class="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal viewModal">
    <div class="modalHead">
      <h2 class="modalTitle" id="vTitle">â€”</h2>
      <button class="close" id="viewClose">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
    </div>
    <div class="viewBody">
      <div>
        <img id="vImg" class="viewImg" alt="">
        <div class="hint">Ø¥Ø°Ø§ Ù„Ù… ØªØ¸Ù‡Ø± ØµÙˆØ±Ø©ØŒ ÙÙ‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù†Ù‡ Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØºÙ„Ø§Ù Ù„Ù„ÙƒØªØ§Ø¨.</div>
      </div>
      <div>
        <div class="meta" id="vMeta"></div>

        <div class="block">
          <h3>ğŸ“ Ù…Ù„Ø®Øµ / ÙˆØµÙ</h3>
          <div id="vDesc"></div>
        </div>

        <div class="rowBtns" style="margin-top:12px">
          <button class="primary" id="editBtn">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="danger" id="deleteBtn">ğŸ—‘ï¸ Ø­Ø°Ù</button>
          <button class="ghost" id="copyBtn">Ù†Ø³Ø® Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(() => {
  "use strict";

  let editId = null;
  let currentId = null; // Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„

  const STORAGE_KEY = "dar_alsalam_library_books_v2";

  const DEWEY_NAMES = {
    "000":"000 Ø§Ù„Ù…Ø¹Ø§Ø±Ù Ø§Ù„Ø¹Ø§Ù…Ø©",
    "100":"100 Ø§Ù„ÙÙ„Ø³ÙØ©",
    "200":"200 Ø§Ù„Ø¯ÙŠÙ†",
    "300":"300 Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",
    "400":"400 Ø§Ù„Ù„ØºØ§Øª",
    "500":"500 Ø§Ù„Ø¹Ù„ÙˆÙ…",
    "600":"600 Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§",
    "700":"700 Ø§Ù„ÙÙ†ÙˆÙ†",
    "800":"800 Ø§Ù„Ø£Ø¯Ø¨",
    "900":"900 Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§"
  };

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
  const DEFAULT_BOOKS = [
    { id: 1, title: "Ø§Ù„Ø£Ù…ÙŠØ± Ø§Ù„ØµØºÙŠØ±", author: "Ø£Ù†Ø·ÙˆØ§Ù† Ø¯Ùˆ Ø³Ø§Ù†Øª Ø¥ÙƒØ²ÙˆØ¨ÙŠØ±ÙŠ", dewey: "800", description: "Ù‚ØµØ© Ø£Ø¯Ø¨ÙŠØ© Ø¹Ù† Ø§Ù„ØµØ¯Ø§Ù‚Ø© ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰.", coverDataUrl: "" },
    { id: 2, title: "Ù…Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ù„ÙˆÙ…", author: "ÙƒØªØ§Ø¨ Ù…Ø¯Ø±Ø³ÙŠ", dewey: "500", description: "Ø´Ø±Ø­ Ù…Ø¨Ø³Ø· Ù„Ù…ÙØ§Ù‡ÙŠÙ… Ø§Ù„Ø¹Ù„ÙˆÙ….", coverDataUrl: "" }
  ];

  const clone = (obj) => (typeof structuredClone === "function")
    ? structuredClone(obj)
    : JSON.parse(JSON.stringify(obj));

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  const grid = document.getElementById("grid");
  const searchEl = document.getElementById("search");
  const deweyFilterEl = document.getElementById("deweyFilter");
  const resetBtn = document.getElementById("resetBtn");
  const addBtn = document.getElementById("addBtn");

  // Stats
  const totalText = document.getElementById("totalText");
  const chips = document.getElementById("chips");

  // Form Modal
  const formBackdrop = document.getElementById("formBackdrop");
  const formClose = document.getElementById("formClose");
  const formTitle = document.getElementById("formTitle");
  const fTitle = document.getElementById("fTitle");
  const fAuthor = document.getElementById("fAuthor");
  const fDewey = document.getElementById("fDewey");
  const fDesc = document.getElementById("fDesc");
  const fCoverFile = document.getElementById("fCoverFile");
  const saveBtn = document.getElementById("saveBtn");
  const cancelBtn = document.getElementById("cancelBtn");

  // View Modal
  const viewBackdrop = document.getElementById("viewBackdrop");
  const viewClose = document.getElementById("viewClose");
  const vTitle = document.getElementById("vTitle");
  const vImg = document.getElementById("vImg");
  const vMeta = document.getElementById("vMeta");
  const vDesc = document.getElementById("vDesc");
  const editBtn = document.getElementById("editBtn");
  const deleteBtn = document.getElementById("deleteBtn");
  const copyBtn = document.getElementById("copyBtn");

  let books = loadBooks();

  function loadBooks() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_BOOKS));
      return clone(DEFAULT_BOOKS);
    }
    try {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) return parsed;
    } catch (e) {}
    localStorage.setItem(STORAGE_KEY, JSON.stringify(DEFAULT_BOOKS));
    return clone(DEFAULT_BOOKS);
  }

  function saveBooks() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(books));
  }

  function escapeHtml(str) {
    return (str ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#39;");
  }

  function nextId() {
    return books.length ? Math.max(...books.map(b => Number(b.id) || 0)) + 1 : 1;
  }

  function matches(book, query, dewey) {
    const text = (book.title + " " + book.author + " " + (book.description || "")).toLowerCase();
    const okQuery = !query || text.includes(query.toLowerCase());
    const okDewey = (dewey === "all") || (book.dewey === dewey);
    return okQuery && okDewey;
  }

  function updateStats() {
    const total = books.length;
    totalText.textContent = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØªØ¨: ${total}`;

    const counts = {};
    Object.keys(DEWEY_NAMES).forEach(k => (counts[k] = 0));
    books.forEach(b => { if (counts[b.dewey] != null) counts[b.dewey]++; });

    chips.innerHTML = Object.keys(DEWEY_NAMES).map(code => {
      return `<div class="chip">${DEWEY_NAMES[code]}: <b>${counts[code]}</b></div>`;
    }).join("");
  }

  function render() {
    const q = searchEl.value.trim();
    const d = deweyFilterEl.value;

    const filtered = books.filter(b => matches(b, q, d));

    grid.innerHTML = filtered.map(b => {
      const img = b.coverDataUrl
        ? `<img src="${b.coverDataUrl}" alt="ØºÙ„Ø§Ù ${escapeHtml(b.title)}">`
        : `<div class="ph">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</div>`;
      return `
        <article class="card">
          <div class="thumb">${img}</div>
          <div class="content">
            <h3 class="title">${escapeHtml(b.title)}</h3>
            <div class="meta">
              <div><b>Ø§Ù„Ù…Ø¤Ù„Ù:</b> ${escapeHtml(b.author)}</div>
              <div><b>Ø¯ÙŠÙˆÙŠ:</b> ${escapeHtml(b.dewey)} â€” ${escapeHtml(DEWEY_NAMES[b.dewey] || "")}</div>
              <div style="margin-top:6px">${escapeHtml(b.description || "")}</div>
            </div>
            <div class="actions">
              <button class="primary" data-open="${b.id}">ÙØªØ­</button>
            </div>
          </div>
        </article>
      `;
    }).join("");

    if (filtered.length === 0) {
      grid.innerHTML = `<div class="card"><div class="content"><h3 class="title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h3><div class="meta">Ø¬Ø±Ù‘Ø¨ Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ Ø¯ÙŠÙˆÙŠ Ù…Ø®ØªÙ„Ù.</div></div></div>`;
    }

    updateStats();
  }

  // ========= View Modal =========
  function openView(id) {
    const b = books.find(x => x.id === id);
    if (!b) return;
    currentId = id;

    vTitle.textContent = b.title || "â€”";
    vImg.src = b.coverDataUrl || "";
    vImg.alt = `ØºÙ„Ø§Ù: ${b.title || ""}`;

    vMeta.innerHTML = `
      <div class="meta"><b>Ø§Ù„Ù…Ø¤Ù„Ù:</b> ${escapeHtml(b.author || "â€”")}</div>
      <div class="meta"><b>ØªØµÙ†ÙŠÙ Ø¯ÙŠÙˆÙŠ:</b> ${escapeHtml(b.dewey)} â€” ${escapeHtml(DEWEY_NAMES[b.dewey] || "")}</div>
    `;

    vDesc.innerHTML = b.description
      ? `<p>${escapeHtml(b.description)}</p>`
      : `<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.</p>`;

    viewBackdrop.style.display = "flex";
    viewBackdrop.setAttribute("aria-hidden", "false");
  }

  function closeView() {
    viewBackdrop.style.display = "none";
    viewBackdrop.setAttribute("aria-hidden", "true");
  }

  // ========= Form Modal (Add/Edit) =========
  function openForm(mode) {
    if (mode === "add") {
      editId = null;
      formTitle.textContent = "â• Ø¥Ø¶Ø§ÙØ© ÙƒØªØ§Ø¨";
      fTitle.value = "";
      fAuthor.value = "";
      fDewey.value = "800";
      fDesc.value = "";
      fCoverFile.value = "";
    } else {
      const b = books.find(x => x.id === currentId);
      if (!b) return;
      editId = b.id;
      formTitle.textContent = "âœï¸ ØªØ¹Ø¯ÙŠÙ„ ÙƒØªØ§Ø¨";
      fTitle.value = b.title || "";
      fAuthor.value = b.author || "";
      fDewey.value = b.dewey || "800";
      fDesc.value = b.description || "";
      fCoverFile.value = "";
    }

    formBackdrop.style.display = "flex";
    formBackdrop.setAttribute("aria-hidden", "false");
  }

  function closeForm() {
    formBackdrop.style.display = "none";
    formBackdrop.setAttribute("aria-hidden", "true");
  }

  function fileToDataUrl(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  async function saveForm() {
    const title = fTitle.value.trim();
    const author = fAuthor.value.trim();
    const dewey = fDewey.value;
    const description = fDesc.value.trim();
    const file = fCoverFile.files && fCoverFile.files[0];

    if (!title || !author) {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø¤Ù„Ù.");
      return;
    }

    let coverDataUrl = null;
    if (file) {
      try {
        coverDataUrl = await fileToDataUrl(file);
      } catch (e) {
        alert("ØªØ¹Ø°Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©.");
        return;
      }
    }

    if (editId == null) {
      books.push({
        id: nextId(),
        title, author, dewey,
        description,
        coverDataUrl: coverDataUrl || ""
      });
    } else {
      const idx = books.findIndex(x => x.id === editId);
      if (idx >= 0) {
        books[idx] = {
          ...books[idx],
          title, author, dewey,
          description,
          coverDataUrl: coverDataUrl != null ? coverDataUrl : books[idx].coverDataUrl
        };
      }
    }

    saveBooks();
    render();
    closeForm();
    closeView();
  }

  function deleteCurrent() {
    const b = books.find(x => x.id === currentId);
    if (!b) return;

    books = books.filter(x => x.id !== currentId);
    saveBooks();
    render();
    closeView();
  }

  // ===== Events =====
  // ÙØªØ­ Ø¨Ø·Ø§Ù‚Ø© (delegation)
  grid.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-open]");
    if (!btn) return;
    const id = Number(btn.getAttribute("data-open"));
    openView(id);
  });

  searchEl.addEventListener("input", render);
  deweyFilterEl.addEventListener("change", render);

  resetBtn.addEventListener("click", () => {
    searchEl.value = "";
    deweyFilterEl.value = "all";
    render();
  });

  addBtn.addEventListener("click", () => openForm("add"));

  formClose.addEventListener("click", closeForm);
  cancelBtn.addEventListener("click", closeForm);
  viewClose.addEventListener("click", closeView);

  saveBtn.addEventListener("click", saveForm);
  editBtn.addEventListener("click", () => openForm("edit"));

  deleteBtn.addEventListener("click", () => {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒØªØ§Ø¨ØŸ")) deleteCurrent();
  });

  copyBtn.addEventListener("click", async () => {
    const b = books.find(x => x.id === currentId);
    if (!b) return;
    try { await navigator.clipboard.writeText(b.title || ""); } catch (e) {}
  });

  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  render();
})();
</script>
</body>
</html>
